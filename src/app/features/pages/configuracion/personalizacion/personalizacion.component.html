<!-- src/app/features/pages/configuracion/personalizacion/personalizacion.component.html -->
<div class="personalizacion-container">
  <div class="header">
    <h1>
      <i class="fas fa-paint-brush"></i>
      Personalizaci√≥n del Sistema
    </h1>
    <button (click)="volver()" class="btn-back">
      <i class="fas fa-arrow-left"></i>
      Volver
    </button>
  </div>

  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Cargando configuraci√≥n...</p>
  </div>

  <div *ngIf="error" class="error-message">
    <i class="fas fa-exclamation-circle"></i>
    {{ error }}
  </div>

  <div *ngIf="success" class="success-message">
    <i class="fas fa-check-circle"></i>
    {{ success }}
  </div>

  <div *ngIf="!loading" class="content-grid">
    <!-- Vista previa en vivo -->
    <div class="preview-section">
      <h2>Vista Previa</h2>
      
      <div class="preview-card">
        <h3>Login</h3>
        <div class="login-preview">
          <app-logo tipo="login" [clickable]="false"></app-logo>
        </div>
      </div>

      <div class="preview-card">
        <h3>Barra de Navegaci√≥n</h3>
        <div class="navbar-preview">
          <app-logo tipo="navbar" [clickable]="false"></app-logo>
        </div>
      </div>
    </div>

    <!-- Formulario de configuraci√≥n -->
    <div class="form-section">
      <form (ngSubmit)="guardar()">
        <h2>Logos del Sistema</h2>
        
        <div class="form-group logo-upload">
          <label>Logo para Login</label>
          <div class="upload-area">
            <div class="current-logo">
              <!-- ‚úÖ Usar las se√±ales computadas -->
              <img *ngIf="config.logo_login && !previewLogin" 
                   [src]="personalizacionService.logoLoginUrl()" 
                   class="preview-img" 
                   (error)="config.logo_login = null">
              <img *ngIf="previewLogin" 
                   [src]="previewLogin" 
                   class="preview-img">
              <div *ngIf="!config.logo_login && !previewLogin" 
                   class="no-logo">
                <i class="fas fa-image"></i>
                <span>Sin logo</span>
              </div>
            </div>
            <div class="upload-controls">
              <input 
                type="file" 
                #fileInputLogin
                accept="image/*"
                (change)="onFileSelected($event, 'login')"
                [disabled]="uploading.login">
              <button type="button" 
                      class="btn-upload" 
                      (click)="fileInputLogin.click()"
                      [disabled]="uploading.login">
                <i class="fas" [ngClass]="uploading.login ? 'fa-spinner fa-spin' : 'fa-upload'"></i>
                {{ uploading.login ? 'Subiendo...' : 'Seleccionar imagen' }}
              </button>
              <button type="button" 
                      *ngIf="previewLogin" 
                      class="btn-cancel-upload" 
                      (click)="cancelarPreview('login')">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
          <small>Recomendado: PNG o SVG, m√°ximo 2MB</small>
        </div>

        <div class="form-group logo-upload">
          <label>Logo para Barra de Navegaci√≥n</label>
          <div class="upload-area">
            <div class="current-logo">
              <!-- ‚úÖ Usar las se√±ales computadas -->
              <img *ngIf="config.logo_navbar && !previewNavbar" 
                   [src]="personalizacionService.logoNavbarUrl()" 
                   class="preview-img" 
                   (error)="config.logo_navbar = null">
              <img *ngIf="previewNavbar" 
                   [src]="previewNavbar" 
                   class="preview-img">
              <div *ngIf="!config.logo_navbar && !previewNavbar" 
                   class="no-logo">
                <i class="fas fa-image"></i>
                <span>Sin logo</span>
              </div>
            </div>
            <div class="upload-controls">
              <input 
                type="file" 
                #fileInputNavbar
                accept="image/*"
                (change)="onFileSelected($event, 'navbar')"
                [disabled]="uploading.navbar">
              <button type="button" 
                      class="btn-upload" 
                      (click)="fileInputNavbar.click()"
                      [disabled]="uploading.navbar">
                <i class="fas" [ngClass]="uploading.navbar ? 'fa-spinner fa-spin' : 'fa-upload'"></i>
                {{ uploading.navbar ? 'Subiendo...' : 'Seleccionar imagen' }}
              </button>
              <button type="button" 
                      *ngIf="previewNavbar" 
                      class="btn-cancel-upload" 
                      (click)="cancelarPreview('navbar')">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
          <small>Recomendado: PNG o SVG, m√°ximo 2MB</small>
        </div>

        <!-- Resto del formulario igual -->
        <h2 class="section-title">Texto del Sistema</h2>

        <div class="form-group">
          <label>Nombre del Sistema *</label>
          <input type="text" 
                 [(ngModel)]="config.nombre_sistema" 
                 name="nombre_sistema" 
                 required 
                 class="form-control"
                 placeholder="Ej: VI√ëA">
          <small>Nombre que aparecer√° en la barra de navegaci√≥n</small>
        </div>

        <div class="form-group">
          <label>Texto del Logo (fallback)</label>
          <input type="text" 
                 [(ngModel)]="config.logo_texto" 
                 name="logo_texto" 
                 maxlength="2" 
                 class="form-control"
                 placeholder="üíß">
          <small>Emoji o letra que se muestra si no hay imagen</small>
        </div>

        <h2 class="section-title">Datos de la Empresa</h2>

        <div class="form-grid">
          <div class="form-group">
            <label>Nombre *</label>
            <input type="text" 
                   [(ngModel)]="config.nombre" 
                   name="nombre" 
                   required 
                   class="form-control">
          </div>

          <div class="form-group">
            <label>RUC *</label>
            <input type="text" 
                   [(ngModel)]="config.ruc" 
                   name="ruc" 
                   required 
                   maxlength="11" 
                   class="form-control">
          </div>

          <div class="form-group full-width">
            <label>Eslogan</label>
            <input type="text" 
                   [(ngModel)]="config.eslogan" 
                   name="eslogan" 
                   class="form-control">
          </div>

          <div class="form-group full-width">
            <label>Direcci√≥n *</label>
            <textarea [(ngModel)]="config.direccion" 
                      name="direccion" 
                      required 
                      rows="2" 
                      class="form-control"></textarea>
          </div>

          <div class="form-group">
            <label>Tel√©fono</label>
            <input type="text" 
                   [(ngModel)]="config.telefono" 
                   name="telefono" 
                   class="form-control">
          </div>

          <div class="form-group">
            <label>Email</label>
            <input type="email" 
                   [(ngModel)]="config.email" 
                   name="email" 
                   class="form-control">
          </div>

          <div class="form-group">
            <label>Sitio Web</label>
            <input type="text" 
                   [(ngModel)]="config.web" 
                   name="web" 
                   class="form-control">
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-save" [disabled]="saving">
            <i class="fas" [ngClass]="saving ? 'fa-spinner fa-spin' : 'fa-save'"></i>
            {{ saving ? 'Guardando...' : 'Guardar Cambios' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>