<h2 mat-dialog-title class="dialog-title">
  <mat-icon class="title-icon">{{ isEditMode ? 'edit' : 'add' }}</mat-icon>
  {{ isEditMode ? 'Editar' : 'Nuevo' }} Producto
</h2>

<mat-dialog-content>
  <div class="loading-overlay" *ngIf="isLoading">
    <mat-spinner diameter="32"></mat-spinner>
  </div>

  <form [formGroup]="productForm" class="product-form">
    <!-- Informaci√≥n B√°sica -->
    <div class="form-section">
      <div class="form-row">
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Nombre</mat-label>
          <input matInput formControlName="nombre" required />
          <mat-error *ngIf="productForm.get('nombre')?.hasError('required')">
            Nombre requerido
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Descripci√≥n</mat-label>
          <textarea 
            matInput 
            formControlName="descripcion" 
            rows="1"
            required>
          </textarea>
          <mat-error *ngIf="productForm.get('descripcion')?.hasError('required')">
            Descripci√≥n requerida
          </mat-error>
        </mat-form-field>
      </div>
     <div class="form-row">
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Precio</mat-label>
          <input 
            matInput 
            type="number" 
            formControlName="precio" 
            min="0.01" 
            step="0.01"
            required />
          <span matPrefix>S/&nbsp;</span>
          <mat-error *ngIf="productForm.get('precio')?.hasError('required')">
            Precio requerido
          </mat-error>
        </mat-form-field>

        <!-- CAMPO STOCK - SIEMPRE DESHABILITADO Y DE SOLO LECTURA -->
<mat-form-field appearance="outline" class="form-field stock-field-readonly">
  <mat-label>Stock</mat-label>
  <input 
    matInput 
    type="number" 
    formControlName="stock" 
    readonly  
  />
  <mat-icon matSuffix class="lock-icon">lock</mat-icon>
  <!-- Mensaje informativo unificado -->
  <mat-hint align="end" class="stock-hint">
    üîí Stock gestionado v√≠a Inventario
  </mat-hint>
</mat-form-field>
      </div>
    </div>
    <!-- Informaci√≥n Comercial -->
    <!-- Categorizaci√≥n -->
    <div class="form-section">
      <div class="form-row">
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Categor√≠a</mat-label>
          <mat-select formControlName="categoriaId" required>
            <mat-option *ngFor="let categoria of categorias" [value]="categoria.id_categoria">
              {{ categoria.nombre }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="productForm.get('categoriaId')?.hasError('required')">
            Categor√≠a requerida
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Marca</mat-label>
          <mat-select formControlName="marcaId" required>
            <mat-option *ngFor="let marca of marcas" [value]="marca.id_marca">
              {{ marca.nombre }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="productForm.get('marcaId')?.hasError('required')">
            Marca requerida
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Pa√≠s Origen</mat-label>
          <mat-select formControlName="paisOrigenId" required>
            <mat-option *ngFor="let pais of paises" [value]="pais.id">
              {{ pais.nombre }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="productForm.get('paisOrigenId')?.hasError('required')">
            Pa√≠s requerido
          </mat-error>
        </mat-form-field>
      </div>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <!-- üü° 1. BOT√ìN LIMPIAR -->
  <button 
    mat-raised-button 
    class="limpiar-button" 
    type="button" 
    (click)="onLimpiar()">
    <mat-icon>refresh</mat-icon>
    Limpiar
  </button>

  <!-- üîµ 2. BOT√ìN GUARDAR -->
  <button
    mat-raised-button
    color="primary"
    (click)="onSubmit()"
    [disabled]="productForm.invalid || isLoading || !isFormReady()"
    class="submit-button"
  >
    <mat-icon>{{ isEditMode ? 'save' : 'check' }}</mat-icon>
    {{ isEditMode ? 'Actualizar' : 'Guardar' }}
  </button>

  <!-- ‚ö´ 3. BOT√ìN CANCELAR -->
  <button mat-button (click)="onCancel()" class="cancel-button">
    <mat-icon>close</mat-icon>
    Cancelar
  </button>
</mat-dialog-actions>

