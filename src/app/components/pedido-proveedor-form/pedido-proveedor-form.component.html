<!-- pedido-proveedor-form.component.html - CORREGIDO -->
<div class="dialog-header">
  <h2 mat-dialog-title>
    {{ isEditMode ? 'Editar Pedido' : 'Nuevo Pedido a Proveedor' }}
  </h2>
  <button mat-icon-button (click)="onCancel()">
    <mat-icon>close</mat-icon>
  </button>
</div>

<mat-dialog-content>
  <form [formGroup]="form" (ngSubmit)="submit()" class="form-container">
    <div class="form-row">
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Proveedor</mat-label>
        <mat-select formControlName="id_proveedor">
          <mat-option *ngFor="let prov of proveedores" [value]="prov.id_proveedor">
            {{ prov.razon_social }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="form.get('id_proveedor')?.hasError('required')">
          El proveedor es requerido
        </mat-error>
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Producto</mat-label>
        <mat-select formControlName="id_producto">
          <mat-option *ngFor="let prod of productos" [value]="prod.id_producto">
            {{ prod.nombre }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="form.get('id_producto')?.hasError('required')">
          El producto es requerido
        </mat-error>
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Fecha</mat-label>
        <input matInput [matDatepicker]="picker" formControlName="fecha">
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
        <mat-error *ngIf="form.get('fecha')?.hasError('required')">
          La fecha es requerida
        </mat-error>
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-form-field appearance="fill" class="half-width">
        <mat-label>Cantidad</mat-label>
        <input matInput type="number" formControlName="cantidad" min="1">
        <mat-error *ngIf="form.get('cantidad')?.hasError('required')">
          La cantidad es requerida
        </mat-error>
        <mat-error *ngIf="form.get('cantidad')?.hasError('min')">
          La cantidad debe ser mayor a 0
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill" class="half-width">
        <mat-label>Costo Unitario (S/)</mat-label>
        <input matInput type="number" formControlName="costo_unitario" min="0" step="0.01">
        <mat-error *ngIf="form.get('costo_unitario')?.hasError('required')">
          El costo unitario es requerido
        </mat-error>
        <mat-error *ngIf="form.get('costo_unitario')?.hasError('min')">
          El costo debe ser mayor o igual a 0
        </mat-error>
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Total (S/)</mat-label>
        <input matInput type="number" formControlName="total" readonly>
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Estado</mat-label>
        <mat-select formControlName="id_estado_pedido">
          <mat-option *ngFor="let estado of estados" [value]="estado.id_estado_pedido">
            {{ estado.estado }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="form.get('id_estado_pedido')?.hasError('required')">
          El estado es requerido
        </mat-error>
      </mat-form-field>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()" [disabled]="isLoading">Cancelar</button>
  <button 
    mat-raised-button 
    color="primary" 
    (click)="submit()" 
    [disabled]="form.invalid || isLoading">
    <span *ngIf="isLoading">Guardando...</span>
    <span *ngIf="!isLoading">{{ isEditMode ? 'Actualizar' : 'Crear' }} Pedido</span>
  </button>
</mat-dialog-actions>