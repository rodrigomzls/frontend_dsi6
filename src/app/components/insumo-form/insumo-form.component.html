<!-- src/app/components/insumo-form/insumo-form.component.html -->
<div class="form-container">
  <h2 mat-dialog-title class="form-title">
    <mat-icon>{{ isEditMode ? 'edit' : 'add' }}</mat-icon>
    {{ isEditMode ? 'Editar Insumo' : 'Nuevo Insumo' }}
  </h2>

  <mat-dialog-content>
    <form [formGroup]="form" class="form-content">
      <!-- Nombre -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Nombre del Insumo *</mat-label>
        <input matInput formControlName="nombre" placeholder="Ej: Botella PET 650ml">
        <mat-error *ngIf="form.get('nombre')?.hasError('required')">
          El nombre es requerido
        </mat-error>
        <mat-error *ngIf="form.get('nombre')?.hasError('minlength')">
          Mínimo 2 caracteres
        </mat-error>
      </mat-form-field>

      <!-- Descripción -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Descripción</mat-label>
        <textarea matInput formControlName="descripcion" rows="3" 
                  placeholder="Descripción del insumo..."></textarea>
      </mat-form-field>

      <div class="row-fields">
        <!-- Unidad de Medida -->
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Unidad de Medida *</mat-label>
          <mat-select formControlName="unidad_medida">
            <mat-option *ngFor="let unidad of unidadesMedida" [value]="unidad">
              {{ unidad }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="form.get('unidad_medida')?.hasError('required')">
            Selecciona una unidad
          </mat-error>
        </mat-form-field>

        <!-- Stock Mínimo -->
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Stock Mínimo *</mat-label>
          <input matInput type="number" formControlName="stock_minimo" min="0">
          <mat-error *ngIf="form.get('stock_minimo')?.hasError('required')">
            Stock mínimo requerido
          </mat-error>
          <mat-error *ngIf="form.get('stock_minimo')?.hasError('min')">
            No puede ser negativo
          </mat-error>
        </mat-form-field>
      </div>

      <div class="row-fields">
        <!-- Costo Promedio -->
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Costo Promedio *</mat-label>
          <span matPrefix>S/ &nbsp;</span>
          <input matInput type="number" formControlName="costo_promedio" min="0" step="0.01">
          <mat-error *ngIf="form.get('costo_promedio')?.hasError('required')">
            Costo requerido
          </mat-error>
          <mat-error *ngIf="form.get('costo_promedio')?.hasError('min')">
            No puede ser negativo
          </mat-error>
        </mat-form-field>

        <!-- Proveedor Principal -->
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Proveedor Principal</mat-label>
          <mat-select formControlName="id_proveedor_principal">
            <mat-option [value]="null">Sin proveedor</mat-option>
            <mat-option *ngFor="let prov of proveedores" [value]="prov.id_proveedor">
              {{ prov.razon_social }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <!-- Checkbox Activo (solo en edición) -->
      <div class="checkbox-section" *ngIf="isEditMode">
        <mat-checkbox formControlName="activo" color="primary">
          Insumo activo
        </mat-checkbox>
      </div>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="onCancel()" [disabled]="isLoading">Cancelar</button>
    <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="isLoading">
      <mat-spinner diameter="20" *ngIf="isLoading"></mat-spinner>
      <span *ngIf="!isLoading">{{ isEditMode ? 'Actualizar' : 'Guardar' }}</span>
    </button>
  </mat-dialog-actions>
</div>